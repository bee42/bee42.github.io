<!doctype html><html lang=de><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Docker als Container-Technologie hat die Entwicklung und den Betrieb von Software seit 2014 in vielerlei Hinsicht revolutioniert. Im Laufe der letzten beide Jahre werden Docker Container nun auch für das Erstellen von portablen ad-hoc Testumgebungen als ideales Werkzeug eingesetzt."><title>The Dark Age of Container Testing</title><link rel=icon href=/images/favicon.ico type=image/x-icon><link rel=stylesheet href=/css/bootstrap.min.css><link href=/css/animate1.css rel=stylesheet><link href=/css/github-gist.css rel=stylesheet><link rel=stylesheet type=text/css href=/css/bicon.min.css><link rel=stylesheet type=text/css href=/css/owl.carousel.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css integrity=sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ crossorigin=anonymous><link rel=stylesheet href=https://bee42.com/sass/style.min.807b9d7ce089a7d39ca870a8727d83ec5a3cbfcaf75ae380e102836b0c36c229.css><link rel=stylesheet type=text/css href=/css/responsive-menu.css><link rel=stylesheet type=text/css href=/css/responsive.css></head><body class=sub-page><nav class=off-canvas><button class=close-btn><i class="fas fa-times"></i></button><ul><li class=menu-item><a href=/de/trainings>Trainings</a></li><li class=menu-item><a href=/de/consulting>Consulting</a></li><li class=menu-item><a href=/de/community>Community</a></li><li class=menu-item><a href=/de/about>Über Uns</a></li><li class=menu-item><a href=/de/jobs>Jobs</a></li><li class=menu-item><a href=/de/kontakt>Kontakt</a></li><li class=menu-item><a href=/de/blog>Blog</a></li><li class=menu-item><a href="https://twitter.com/bee42solutions?lang=%2fde" target=_blank><i class="fab fa-twitter"></i></a></li></ul></nav><div id=page><header class=site-header><div class=inner-header><a class=branding href=/index.html><img src=/images/bee42-logo.svg alt="bee42 Logo"></a>
<button class=open-btn><i class="fas fa-bars"></i></button><div class=off-canvas-btn><a id=mob-menu>☰</a>
<a id=mob-menu-close>×</a></div><nav class=site-navigation><ul id=menu-header-menu class=menu><li class=menu-item><a href=/de/trainings>Trainings</a></li><li class=menu-item><a href=/de/consulting>Consulting</a></li><li class=menu-item><a href=/de/community>Community</a></li><li class=menu-item><a href=/de/about>Über Uns</a></li><li class=menu-item><a href=/de/jobs>Jobs</a></li><li class=menu-item><a href=/de/kontakt>Kontakt</a></li><li class=menu-item><a href=/de/blog>Blog</a></li><li class=menu-item><a href="https://twitter.com/bee42solutions?lang=%2fde" target=_blank><i class="fab fa-twitter"></i></a></li></ul></nav></div><h1>Rethink IT</h1><h2>Wir verbessern Deine Systeme mit Begeisterung.</h2><a href=https://bee42.com/de/about class="button hero-button">Über die bee⁴²</a></header><div id=content><div class=blog-detail-wrapper><div class="col-lg-9 col-sm-8 col-md-8"><article class=post><h2>The Dark Age of Container Testing</h2><div class=blog-content><p><p>Es war einmal vor langer Zeit, in einer weit entfernten Software-Entwicklungs-Galaxie, da war Computing-Zeit teuer und menschliche Arbeit billig. Einen Computer verwenden um Software zu testen? Undenkbar! Dafür können wir doch Tester einstellen und ausführliche Testhandbücher schreiben.</p><div class=default-slider><img src=/images/blog/testcontainers/Ancient-Book.jpg alt></div><p>(Quelle: <a href=http://www.ancient-origins.net/sites/default/files/field/image/Ancient-Book.jpg>http://www.ancient-origins.net/sites/default/files/field/image/Ancient-Book.jpg</a>)</p><p>Doch auch später, als es üblich wurde Unit-Tests zu schreiben, wurde Testen von Entwicklern gerne stiefmütterlich behandelt. Interessanterweise gibt es verschiedene historische Definitionen von <em>Unit</em> in diesem Kontext, das Wort meint entweder die zu testestende Einheit der Software, oder besagt, dass der Tests selber eine Einheit darstellt. Meist wurde dem <strong>over-the-shoulder</strong> Prinzip gefolgt und das Testen der Testabteilung überlassen. Ob diese Abteilung automatisiert oder manuell testet, was kümmert mich das als Entwickler! Aus dieser Zeit, und lehrreichen Softwaretechnikvorlesungen, ist dem einen oder anderen sicherlich die klassische Testpyramide bekannt.</p><div class=default-slider><img src=/images/blog/testcontainers/testing-pyramid.png alt></div><p>(Quelle: <a href=https://blog.namics.com/2012/06/tour-durch-die-testpyramide.html>https://blog.namics.com/2012/06/tour-durch-die-testpyramide.html</a>)</p><h2 id=die-agile-revolution>Die Agile-Revolution</h2><p>Diese Einstellung in Bezug aufs Testen änderte sich Mitte der 90ern im Zuge der Agile-Revolution mit dem Aufkommen von Techniken wie Xtreme Programming (<a href=https://de.wikipedia.org/wiki/Extreme_Programming>XP</a>) und Test Driven Development (<a href=https://de.wikipedia.org/wiki/Testgetriebene_Entwicklung>TDD</a>), sowie einer gehoben Wertschätzung für den Aspekt der Software-Qualität zumindest in Teilen der Entwickler-Community. Das Schreiben von Unit-Tests fiel im Zuge von TDD nun eindeutig in den Verantwortungsbereich des Entwicklers und auch Integration-Tests wurden, wo nötig, von Entwicklern geschrieben. Wann immer möglich wurde allerdings versucht auf Integration-Tests zu verzichten, waren diese doch eine zeitaufwändige und fragile Angelegenheit, schließlich musste sich wohlmöglich die gesamte Entwicklungsabteilung die selbe, mühsam von Hand gepflegte, Testumgebung für die Integration-Tests teilen.</p><h2 id=testen-im-microservice-zeitalter>Testen im Microservice-Zeitalter</h2><p>Vor kurzem hat Spotify einen interessanten <a href=https://labs.spotify.com/2018/01/11/testing-of-microservices/>Blogartikel</a> zum Thema <em>Testen von Microservices</em> veröffentlicht, in dem die Nützlichkeit der klassischen Testpyramide in Frage gestellt wird und die Testhonigwabe als alternatives Paradigma vorgestellt wird.</p><div class=default-slider><img src=/images/blog/testcontainers/microservices-testing.png alt></div><p>(Quelle: <a href=https://labs.spotify.com/2018/01/11/testing-of-microservices/>https://labs.spotify.com/2018/01/11/testing-of-microservices/</a>)</p><p>Unabhängig davon, ob man nun die Ansichten der Autoren zum Verhältnis Unit- vs Integration-Tests teilt, sollte man sich zumindest ihre Definition von Integrated-Test (<strong>NICHT</strong> Integration-Test) durch den Kopf gehen lassen:</p><blockquote><p>A test that will pass or fail based on the correctness of another system.
Some signs of having Integrated Tests are:</p><ul><li>We spin up other services in a local testing environment</li><li>We test against other services in a shared testing environment</li><li>Changes to your system breaks tests for other systems
This is a quite fragile way of testing and we recommend learning more directly from the source above.</li></ul></blockquote><p>Aber wie genau können wir uns von der gemeinsam verwendeten Testumgebung emanzipieren?</p><h2 id=docker-testcontainers-to-the-rescue>Docker + Testcontainers to the rescue</h2><p>Docker als Container-Technologie hat die Entwicklung und den Betrieb von Software seit 2014 in vielerlei Hinsicht revolutioniert. Im Laufe der letzten beide Jahre werden Docker Container nun auch für das Erstellen von portablen ad-hoc Testumgebungen als ideales Werkzeug eingesetzt. Gerade für Java-Entwickler existieren bereits einige, auf Docker basierende Tools, die eine einfache Integration in die gewohnten Entwicklungsprozesse ermöglichen, zum Beispiel das exzellente <a href=https://github.com/fabric8io/docker-maven-plugin>docker-maven-plugin</a>. Ein weiteres Beispiel ist die Java Library <a href=https://github.com/testcontainers/testcontainers-java>Testcontainers</a>, die eine native JUnit Integration und für die Spock-Fans gibt es außerdem eine <a href=https://github.com/testcontainers/testcontainers-spock>Spock-Erweiterung</a> anbietet.</p><div class=default-slider><img src=/images/blog/testcontainers/testcontainer-logo.png alt></div><p>Im folgenden wird anhand einer einfachen Beispielanwendung der Einsatz von Testcontainers demonstriert.</p><h2 id=der-obligatorische-bücherkatalog>Der obligatorische Bücherkatalog</h2><p>Wie kann man Konzepte besser vermitteln, als am Beispiel des klassischen Bücherkatalogs? Vermutlich ist jedes andere beliebige Beispiel mittlerweile besser geeignet und weniger abgedroschen, doch dies soll uns nicht davon abhalten, uns am Beispiel einer Bücherkatalog-Applikation die Konzepte von Testcontainers ein wenig näher anzuschauen.</p><h3 id=integration-tests-gegen-rdmbs>Integration-Tests gegen RDMBS</h3><p>Angenommen wir folgen den Begrifflichkeiten von <a href=https://de.wikipedia.org/wiki/Domain-driven_Design>Domain Driven Design</a> und nutzen ein Repository zum Persistiern unserer Buch-Domänen-Objekte in eine relationale Datenbank, wir könnten die Integration-Test aussehen? Manch ein Team würde nun vielleicht Tests innerhalb einer geteilten, in einer Testumgebung, aufgesetzten Datenbank ausführen. Am Besten sogar in geteilten Schematas die automatisch generiert werden. Wer durch solcherlei Praktiken schon genug Schmerzen erfahren hat, wird vielleicht eher zu einer isoliert testbaren H2 In-Memory Datenbank tendieren. Doch auch diese Variante ist nicht frei von Problemen, die Schmerzen treten hier lediglich in anderer Form auf. Wer kennt es nicht, die Integration-Tests laufen wunderbar mit der H2, aber wenn die Software dann in Produktion mit dem Oracle-RAC interagieren muss, dann macht sie die Grätsche. Testcontainer bietet sich hier als Alternative an, die es erlaubt, Integration-Tests in einer eigenen, Ad-Hoc erstellten, Testumgebung mit den echten zu testenden Softwarekompenenten durchzuführen.</p><p>Hier die klassische Struktur des Book Repositories:</p><pre><code class=language-java>public class BookRepository {

    private final String jdbcUrl;
    private final String username;
    private final String password;

    public BookRepository(String jdbcUrl, String username, String password) {
        this.jdbcUrl = jdbcUrl;
        this.username = username;
        this.password = password;
    }

    public void save(Book book) {
        // ...
    }

    public long count() {
        // ...
    }

    public List&lt;Book&gt; findAllByAuthor(String author) {
        // ...
    }

}
</code></pre><p>Die dazugehörigen Integrations-Tests, als JUnit 4 Tests implementiert, sehen wie folgt aus:</p><pre><code class=language-java>public class BookRepositoryTests {

    @Rule
    public PostgreSQLContainer databaseContainer = new PostgreSQLContainer();

    @Before
    public void setup() {
        Flyway flyway = new Flyway();
        flyway.setDataSource(databaseContainer.getJdbcUrl(), databaseContainer.getUsername(),
                databaseContainer.getPassword());
        flyway.migrate();
    }

    private BookRepository buildRepository() {
        return new BookRepository(databaseContainer.getJdbcUrl(), databaseContainer.getUsername(),
                databaseContainer.getPassword());
    }

    @Test
    public void emptyRepository_isEmpty() {
        BookRepository bookRepository = buildRepository();
        assertEquals(0L, bookRepository.count());
    }

    @Test
    public void repository_contains_one_book_after_saving_it() {
        BookRepository bookRepository = buildRepository();
        Book mobyDick = new Book(&quot;Moby Dick&quot;, &quot;Herman Melville&quot;);

        bookRepository.save(mobyDick);

        assertEquals(1L, bookRepository.count());
    }

    @Test
    public void repository_finds_books_of_given_author() {
        BookRepository bookRepository = buildRepository();
        Book mobyDick = new Book(&quot;Moby Dick&quot;, &quot;Herman Melville&quot;);
        String terryPratchett = &quot;Terry Pratchett&quot;;
        Book magic = new Book(&quot;The Colour of Magic&quot;, terryPratchett);
        Book elephant = new Book(&quot;The Fifth Elephant&quot;, terryPratchett);

        bookRepository.save(mobyDick);
        bookRepository.save(magic);
        bookRepository.save(elephant);

        List&lt;Book&gt; queriedBooks = bookRepository.findAllByAuthor(terryPratchett);

        assertEquals(2, queriedBooks.size());
        assertThat(queriedBooks, hasItems(magic, elephant));
    }

}
</code></pre><p>Der Testcontainers-Code Anteil in diesem Beispiel ist hierbei denkbar gering:</p><pre><code class=language-java>@Rule
public PostgreSQLContainer databaseContainer = new PostgreSQLContainer();
</code></pre><p>Die <code>PostgreSQLContainer</code>-Klasse ist hierbei eine spezielle Testcontainers-Klasse, die verschiedene Komfort-Methoden, wie z.B. <code>getJdbcUrl()</code> anbietet. Alternativ kann auch jedes andere beliege Docker-Image in Form einers <code>GenericContainer</code> verwendet werden. Wenn diese Klasse nun innerhalb einer JUnit-Testklasse mit <code>@Rule</code> annotiert wird, so sorgt dies dafür, dass der Postgres-Datenbankcontainer für jede einzelne Testmethode neu hochgefahren wird. Alternativ kann auch <code>@ClassRule</code> verwendet werden, dies sorgt dafür, dass sich alle Testmethoden einer Testklasse den gleichen Datenbankcontainer teilen.</p><p>Im <code>@Before</code> Block sehen wir außerdem, dass <a href=https://flywaydb.org/>Flyway</a> verwendet wird. Dies hat mit Testcontainers an sich erstmal nichts zu tun, ist allerdings eine sehr praktische Java-Library für Datenbankmigrationen.</p><h3 id=integration-tests-gegen-insert-your-favourite-software-here>Integration-Tests gegen $insert-your-favourite-software-here</h3><p>Grundsätzlich lässt sich Testcontainers mit jeder Software nutzen, die sich innerhalb eines Docker-Containers ausführen lässt. Abseits von <code>PostgreSQLContainer</code> und <code>GenericContainer</code> gibt es noch viele weitere spezielle Klassen, die übliche Software in komfortable Art und Weise bereitstellen. Beispiele sind Kafka, Cassandra, oder Selenium. Auch Integration-Tests gegen selbstgeschriebene Software-Komponenten sind dank <code>GenericContainer</code> kein Problem.</p><p>PS: Testcontainers unterstützt Linux, Docker Machine, Docker for Mac und Docker for Window out-of-the-box (Windows so gut out-of-the-box wie man es von Windows ewarten kann, siehe: <a href=https://www.testcontainers.org/usage/windows_support.html>Windows Support</a>) :relaxed:.</p><h2 id=test-container-labs>Test Container Labs</h2><p>Wir freuen uns darüber, das wir Kevin Wittek für unser Test Container Lab als Trainer gewinnen konnten.
Lasst von Euch hören, wenn das Thema spannen für Euch ist und Ihr effiziente Hilfe bei der Umsetzung benötigt.</p><div class=default-slider><img src=/images/blog/testcontainers/container-testing-lab-400.png alt></div><p>Du willst mehr zum Container Testing lernen? Dann besuche doch unser neues <a href=/de/trainings/container-lab-mit-testcontainers/>Container Testing Lab</a> mit Kevin Wittek!</p><h2 id=links>Links</h2><ul><li><a href=https://github.com/testcontainers/testcontainers-java>Testcontainers</a></li><li><a href=https://labs.spotify.com/2018/01/11/testing-of-microservices/>Testing of Microservices</a></li><li><a href=http://blog.thecodewhisperer.com/permalink/integrated-tests-are-a-scam>Integrated Tests are a Scam</a></li></ul></p></div><div class=clearfix></div></article></div><div class="col-lg-3 col-sm-4 col-md-4"><div id=blog-archive-sidebar class=sidebar><div class="widget panel wpforms-widget"><div class="wpforms-container wpforms-container-full" id=wpforms-31107><form class="wpforms-validate wpforms-form"><div class=wpforms-head-container><div class=wpforms-title>Werde Teil unserer bee42 community</div><div class=wpforms-description>Erhalte alle 14 Tage die neusten Blogposts, Trend, Events und Highlights rund um Docker, Kubernetes & Co.!</div></div><div class=wpforms-field-container><div class="wpforms-field wpforms-field-email"><input type=email class=wpforms-field-large placeholder="E-Mail-Adresse eingeben"></div></div><div class=wpforms-submit-container><button type=submit name=wpforms[submit] class=wpforms-submit value=wpforms-submit data-alt-text=Subscribing...>Abonieren</button></div></form></div></div><div class="widget panel popular-posts panel-secondary"><h2 class=section-title>Popular Posts</h2><ul><li><i class="bi bi-blog"></i><a href=https://bee42.com/de/blog/tutorials/docker-hosts-mit-puppet-provisionieren-und-testen/>Docker-Hosts mit Puppet provisionieren und testen</a></li><li><i class="bi bi-blog"></i><a href=https://bee42.com/de/blog/tutorials/docker-microservice-basis-mit-apache-tomcat-implementieren/>Docker Microservice Basis mit Apache Tomcat implementieren</a></li><li><i class="bi bi-blog"></i><a href=https://bee42.com/de/blog/tutorials/docker-entschluesselt-netzwerk-teil-2/>Docker entschlüsselt: Netzwerk Teil 2</a></li></ul></div></div></div></div></div><div class=overlay></div><footer><div class="container clear"><a class=branding href=index.html><img src=/images/bee42-logo.svg alt="bee42 logo"></a><ul class=footer-social-menu><li><a href=mailto:info@bee42.com><i class="fas fa-envelope"></i></a></li><li><a href=https://www.youtube.com/channel/UCQZcFFlmKBBAhvSupNTm2tw><i class="fab fa-youtube"></i></a></li><li><a href="https://twitter.com/bee42solutions?lang=%2fde"><i class="fab fa-twitter"></i></a></li></ul><div class="row footer-info"><ul class=meta-navigation><li><a href=/de/impressum>Impressum</a></li><li><a href=/de/datenschutz>Datenschutz</a></li><li><a href=/de/allgemeine-geschaeftsbedingungen>AGB</a></li><li><a href=/de/kontakt>Kontakt</a></li></ul><form class=newsletter method=post><h3>Newsletter abonnieren</h3><input class=email type=email placeholder="Deine E-Mail Adresse">
<button class=send>Senden</button></form><div class="row address"><a href=/de/locations/bochum><i class="fas fa-map-marker-alt"></i></a><ul class=location><li><strong>bee42 solutions gmbh</strong></li><li>Office: @Funkhaus Bochum</li><li>Kortumstraße 68</li><li>D-44787 Bochum</li></ul></div></div></div><div class=copyright><div class=container><p>© 2018 bee42 solutions gmbh. Alle Rechte vorbehalten</p></div></div></footer></div><div id=menu-sld class=mbmnu><div class=mobmenu-inner><ul id=menu-header-menu1 class=menu><li class=menu-item><a href=/de/trainings>Trainings</a></li><li class=menu-item><a href=/de/consulting>Consulting</a></li><li class=menu-item><a href=/de/community>Community</a></li><li class=menu-item><a href=/de/about>Über Uns</a></li><li class=menu-item><a href=/de/jobs>Jobs</a></li><li class=menu-item><a href=/de/kontakt>Kontakt</a></li><li class=menu-item><a href=/de/blog>Blog</a></li><li class=menu-item><a href="https://twitter.com/bee42solutions?lang=%2fde" target=_blank><i class="fab fa-twitter"></i></a></li></ul></div></div></div><div class=cookies-info id=cookies-container><p>"Um unsere Webseite für Sie optimal zu gestalten und fortlaufend verbessern zu können, verwenden wir Cookies. Durch die weitere Nutzung der Webseite stimmen Sie der Verwendung von Cookies zu. Weitere Informationen zu Cookies erhalten Sie in unserer <a href>Datenschutzerklärung</a>."</p><button id=cn-accept-cookie onclick="SetCookie('cookie_notice','0','7')">Ok</button></div><script>function SetCookie(c_name,value,expiredays){var exdate=new Date();exdate.setDate(exdate.getDate()+expiredays);document.cookie=c_name+"="+escape(value)+
((expiredays==null)?"":";expires="+exdate.toGMTString());document.getElementById("cookies-container").style.display="none";}
if(document.cookie){document.getElementById("cookies-container").style.display="none";}</script><script src=/js/jquery.js></script><script src=/js/bootstrap.min3.2.js></script><script src=/js/owl.carousel.min.js></script><script src=/js/highlight.pack.js></script><script src=/js/js-functions.js></script></body></html>