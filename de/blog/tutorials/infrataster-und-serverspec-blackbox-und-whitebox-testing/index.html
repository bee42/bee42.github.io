<!doctype html><html lang=de><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Für Infrastrukturtest bieten sich verschiedene Verfahren an. Aus der Softwareentwicklung sind Blackbox- und Whitebox-Tests bekannt. In diesem Blogpost stellen wir diese vor und vergleichen sie."><title>infrataster und serverspec: Blackbox- und Whitebox-Testing</title><link rel=icon href=/images/favicon.ico type=image/x-icon><link rel=stylesheet href=/css/bootstrap.min.css><link href=/css/animate1.css rel=stylesheet><link href=/css/github-gist.css rel=stylesheet><link rel=stylesheet type=text/css href=/css/bicon.min.css><link rel=stylesheet type=text/css href=/css/owl.carousel.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.2.0/css/all.css integrity=sha384-hWVjflwFxL6sNzntih27bfxkr27PmbbK/iSvJ+a4+0owXq79v+lsFkW54bOGbiDQ crossorigin=anonymous><link rel=stylesheet href=https://bee42.com/sass/style.min.807b9d7ce089a7d39ca870a8727d83ec5a3cbfcaf75ae380e102836b0c36c229.css><link rel=stylesheet type=text/css href=/css/responsive-menu.css><link rel=stylesheet type=text/css href=/css/responsive.css></head><body class=sub-page><nav class=off-canvas><button class=close-btn><i class="fas fa-times"></i></button><ul><li class=menu-item><a href=/de/trainings>Trainings</a></li><li class=menu-item><a href=/de/consulting>Consulting</a></li><li class=menu-item><a href=/de/community>Community</a></li><li class=menu-item><a href=/de/about>Über Uns</a></li><li class=menu-item><a href=/de/jobs>Jobs</a></li><li class=menu-item><a href=/de/kontakt>Kontakt</a></li><li class=menu-item><a href=/de/blog>Blog</a></li><li class=menu-item><a href="https://twitter.com/bee42solutions?lang=%2fde" target=_blank><i class="fab fa-twitter"></i></a></li></ul></nav><div id=page><header class=site-header><div class=inner-header><a class=branding href=/index.html><img src=/images/bee42-logo.svg alt="bee42 Logo"></a>
<button class=open-btn><i class="fas fa-bars"></i></button><div class=off-canvas-btn><a id=mob-menu>☰</a>
<a id=mob-menu-close>×</a></div><nav class=site-navigation><ul id=menu-header-menu class=menu><li class=menu-item><a href=/de/trainings>Trainings</a></li><li class=menu-item><a href=/de/consulting>Consulting</a></li><li class=menu-item><a href=/de/community>Community</a></li><li class=menu-item><a href=/de/about>Über Uns</a></li><li class=menu-item><a href=/de/jobs>Jobs</a></li><li class=menu-item><a href=/de/kontakt>Kontakt</a></li><li class=menu-item><a href=/de/blog>Blog</a></li><li class=menu-item><a href="https://twitter.com/bee42solutions?lang=%2fde" target=_blank><i class="fab fa-twitter"></i></a></li></ul></nav></div><h1>Rethink IT</h1><h2>Wir verbessern Deine Systeme mit Begeisterung.</h2><a href=https://bee42.com/de/about class="button hero-button">Über die bee⁴²</a></header><div id=content><div class=blog-detail-wrapper><div class="col-lg-9 col-sm-8 col-md-8"><article class=post><h2>infrataster und serverspec: Blackbox- und Whitebox-Testing</h2><div class=blog-content><p><p>Für Infrastrukturtest bieten sich verschiedene Verfahren an. Aus der Softwareentwicklung
sind <a href=http://de.wikipedia.org/wiki/Black-Box-Test><strong>Blackbox</strong></a> - und
<a href=http://de.wikipedia.org/wiki/White-Box-Test><strong>Whitebox</strong></a>-Tests bekannt.
Bei der ersten Variante wird das, was man testen möchte ausschließlich von
außen (als Black Box) betrachtet, und das Verhalten der Komponenten wird über
seine Schnittstellen gegenüber einer Spezifikation bewertet.</p><h2 id=whitebox>Whitebox &hellip;</h2><p>Bei Whitebox-Tests fließen Detailinformationen der zu testenden
Komponente ein, d.h. man muss also in die Komponente hereinschauen können, um
den Test durchzuführen.</p><p>In den letzten Posts über <a href=http://www.serverspec.org/>serverspec</a> haben wir uns
mit Whitebox-Testing beschäftigt. Hier beschreiben wir in einer Spezifikation
den Detailaufbau eines Servers, und serverspec prüft für uns diese Dinge ab.
Dazu muss serverspec natürlich in/auf den Server schauen.</p><p>Wenn der Server beispielsweise einen Webservice bereitstellt, können wir mit serverspec prüfen,</p><ul><li>ob die Pakete für Middleware und Applikation installiert sind,</li><li>ob die Applikation ihre Konfigurationsdateien besitzt,</li><li>und diese korrekt sind,</li><li>ob der Service startet und einen Netzwerkport belegt,</li><li>und vieles mehr.</li></ul><p>Damit ist nur leider nicht gesagt, dass der Webservice auch wie gewünscht
funktioniert. Mit dem Whitebox-Test haben wir nur die Grundlagen abgeprüft, die
überhaupt erst einmal notwendig sind.</p><p>Man könnte im nächsten Schritt mit einem Tool wie curl oder wget innerhalb
des Servers einen HTTP-Call absetzen und das Ergebnis prüfen. Die Funktionsfähigkeit
kann von außen betrachtet aber immer noch scheitern, etwa weil die Netzwerkkonfiguration nicht stimmt
oder iptables den Zugriff verhindert.</p><h2 id=und-blackbox>&hellip; und Blackbox</h2><p>Das wiederum lässt sich mit einem Test von außen abprüfen. Wenn ein anderer
Server den Service abfragt und ein korrektes Ergebnis erhält, kann man schon eher
sicher sein, dass alles korrekt ist.</p><p>Da serverspec erweiterbar ist, lassen sich prinzipiell auch Blackbox-Tests
durchführen. Ein einfaches - allerdings unschönes - Beispiel nutzt das Kommandozeilentool
<code>curl</code> um einen HTTP-Call zu platzieren und Daten aus der Ausgabe zu prüfen:</p><pre><code class=language-ruby>describe command 'curl http://appserver:8080/test' do
  it { should return_exit_status 0 }
  its(:stdout) { should match /^success$/ }
end
</code></pre><p>Das sollte funktionieren, wandelt aber den deklarativen Ansatz von serverspec in einen
imperativen um: Wir beschreiben nicht eine Webresource, sondern konstruieren ein
<code>command</code>, um sie abzufragen. Vor allem wenn beim curl-Aufruf Parameter übergeben werden, vielleicht
noch über HTTP POST, wird der Einzeiler länger und unschöner.</p><h2 id=geschmacksprobe-infrataster>Geschmacksprobe: Infrataster</h2><p>Glücklicherweise gibt es ein Projekt, das den Blackbox-Ansatz in rspec-Art und
Weise umsetzt, <a href=https://github.com/ryotarai/infrataster>Infrataster</a>. Dies ist
eine Erweiterung auf rspec, die verschiedene Typen einführt um Calls abzusetzen
und das Ergebnis abzuprüfen. Dabei werden Webcrawler-Frameworks aus der Ruby-Welt
eingesetzt um dennoch bei einer lesbaren Testspezifikation bleiben zu können.</p><p>Das sieht dann beispielsweise so aus:</p><pre><code class=language-ruby>describe server(:app) do
	describe http('http://appserver:8080/test') do
		it &quot;responds content including 'success'&quot; do
			expect(response.body).to include('success')
		end
	end
end
</code></pre><p>Hier wird im äußeren describe-Block der zu testenden Server angegeben (<code>:app</code>, s.u.),
im inneren Block die Ressource (<code>appserver:8080/test</code>), und die Expectations, z.B.
bezüglich der Rückgabe.</p><p>Infrataster kann dabei die Rückgabe auch detaillierter prüfen, etwa ob
bestimmte Response-Header gesetzt sind, hier, ob der Content-Type <code>text/html</code> entspricht:</p><pre><code class=language-ruby>		it &quot;responds as 'text/html'&quot; do
			expect(response.headers['content-type']).to match(%r{^text/html})
		end
</code></pre><p>Außerdem kann man bei Konstruktion des Calls auch Parameter mitgeben, z.B.</p><pre><code class=language-ruby>	describe http(
    		'http://appserver:8080/foo/app',
    		method:   :get,
    		params:   {'foo'   =&gt; 'bar'},
    		headers:  {'USER'  =&gt; 'VALUE'}
  	) do
    ...
    ...
</code></pre><p>Damit lassen sich Webservices auch von außen gut testen. Weitere Post zeigen
die Verdrahtung zu den Zielservern (&rdquo;:app&rdquo;), die Nutzung von Proxies,
wie Infrataster aufgebaut ist, und wie man damit ein reales Testszenario aufsetzt.</p><h2 id=beides-zusammen-ftw>Beides zusammen, FTW!</h2><p>Weder Blackbox- noch Whitebox-Tests sind für sich genommen ausreichend. Wenn
innerhalb der Komponente alles in Ordnung ist (Whitebox) heisst das nicht
automatisch, dass ihr Verhalten nach außen wie gewünscht funktioniert.</p><p>Umgekehrt kann man aus einem fehlschlagenden Blackbox-Test noch nicht ermitteln,
woran es eigentlich scheitert, d.h. der Fehler ist erkennbar, aber nicht
lokalisierbar.</p><p>Um Infrastrukturkomponenten qualitativ testen zu können, sind sowohl White-
als auch Blackbox-Tests sehr sinnvoll. Hier ist die Kombination von
serverspec und Infrataster wirksam und empfehlenswert!</p><p>&ndash;
Andreas</p></p></div><div class=clearfix></div></article></div><div class="col-lg-3 col-sm-4 col-md-4"><div id=blog-archive-sidebar class=sidebar><div class="widget panel wpforms-widget"><div class="wpforms-container wpforms-container-full" id=wpforms-31107><form class="wpforms-validate wpforms-form"><div class=wpforms-head-container><div class=wpforms-title>Werde Teil unserer bee42 community</div><div class=wpforms-description>Erhalte alle 14 Tage die neusten Blogposts, Trend, Events und Highlights rund um Docker, Kubernetes & Co.!</div></div><div class=wpforms-field-container><div class="wpforms-field wpforms-field-email"><input type=email class=wpforms-field-large placeholder="E-Mail-Adresse eingeben"></div></div><div class=wpforms-submit-container><button type=submit name=wpforms[submit] class=wpforms-submit value=wpforms-submit data-alt-text=Subscribing...>Abonieren</button></div></form></div></div><div class="widget panel popular-posts panel-secondary"><h2 class=section-title>Popular Posts</h2><ul><li><i class="bi bi-blog"></i><a href=https://bee42.com/de/blog/tutorials/docker-hosts-mit-puppet-provisionieren-und-testen/>Docker-Hosts mit Puppet provisionieren und testen</a></li><li><i class="bi bi-blog"></i><a href=https://bee42.com/de/blog/tutorials/docker-microservice-basis-mit-apache-tomcat-implementieren/>Docker Microservice Basis mit Apache Tomcat implementieren</a></li><li><i class="bi bi-blog"></i><a href=https://bee42.com/de/blog/tutorials/docker-entschluesselt-netzwerk-teil-2/>Docker entschlüsselt: Netzwerk Teil 2</a></li></ul></div></div></div></div></div><div class=overlay></div><footer><div class="container clear"><a class=branding href=index.html><img src=/images/bee42-logo.svg alt="bee42 logo"></a><ul class=footer-social-menu><li><a href=mailto:info@bee42.com><i class="fas fa-envelope"></i></a></li><li><a href=https://www.youtube.com/channel/UCQZcFFlmKBBAhvSupNTm2tw><i class="fab fa-youtube"></i></a></li><li><a href="https://twitter.com/bee42solutions?lang=%2fde"><i class="fab fa-twitter"></i></a></li></ul><div class="row footer-info"><ul class=meta-navigation><li><a href=/de/impressum>Impressum</a></li><li><a href=/de/datenschutz>Datenschutz</a></li><li><a href=/de/allgemeine-geschaeftsbedingungen>AGB</a></li><li><a href=/de/kontakt>Kontakt</a></li></ul><form class=newsletter method=post><h3>Newsletter abonnieren</h3><input class=email type=email placeholder="Deine E-Mail Adresse">
<button class=send>Senden</button></form><div class="row address"><a href=/de/locations/bochum><i class="fas fa-map-marker-alt"></i></a><ul class=location><li><strong>bee42 solutions gmbh</strong></li><li>Office: @Funkhaus Bochum</li><li>Kortumstraße 68</li><li>D-44787 Bochum</li></ul></div></div></div><div class=copyright><div class=container><p>© 2018 bee42 solutions gmbh. Alle Rechte vorbehalten</p></div></div></footer></div><div id=menu-sld class=mbmnu><div class=mobmenu-inner><ul id=menu-header-menu1 class=menu><li class=menu-item><a href=/de/trainings>Trainings</a></li><li class=menu-item><a href=/de/consulting>Consulting</a></li><li class=menu-item><a href=/de/community>Community</a></li><li class=menu-item><a href=/de/about>Über Uns</a></li><li class=menu-item><a href=/de/jobs>Jobs</a></li><li class=menu-item><a href=/de/kontakt>Kontakt</a></li><li class=menu-item><a href=/de/blog>Blog</a></li><li class=menu-item><a href="https://twitter.com/bee42solutions?lang=%2fde" target=_blank><i class="fab fa-twitter"></i></a></li></ul></div></div></div><div class=cookies-info id=cookies-container><p>"Um unsere Webseite für Sie optimal zu gestalten und fortlaufend verbessern zu können, verwenden wir Cookies. Durch die weitere Nutzung der Webseite stimmen Sie der Verwendung von Cookies zu. Weitere Informationen zu Cookies erhalten Sie in unserer <a href>Datenschutzerklärung</a>."</p><button id=cn-accept-cookie onclick="SetCookie('cookie_notice','0','7')">Ok</button></div><script>function SetCookie(c_name,value,expiredays){var exdate=new Date();exdate.setDate(exdate.getDate()+expiredays);document.cookie=c_name+"="+escape(value)+
((expiredays==null)?"":";expires="+exdate.toGMTString());document.getElementById("cookies-container").style.display="none";}
if(document.cookie){document.getElementById("cookies-container").style.display="none";}</script><script src=/js/jquery.js></script><script src=/js/bootstrap.min3.2.js></script><script src=/js/owl.carousel.min.js></script><script src=/js/highlight.pack.js></script><script src=/js/js-functions.js></script></body></html>