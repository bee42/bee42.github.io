<!DOCTYPE html>

<html lang="de-DE">

<head>
	<title>Kubernetes Cluster on Embedded</title>
	<meta charset="UTF-8">
	<meta name="description" content="Kubernetes in aller Munde Viele Entwickler und Administatoren interssieren sich gerade für Kubernetes. In allen großen Clouds ist Kuberentes verfügbar. Allerdings ist die Cloud für kleine Geldbeutel auf die Dauer etwas teuer. Um einfach mal verschiedene Experimente mit Kubernetes zu wagen gibt es doch bestimmt günstigere Weg die Spaß machen.
Die Idee Wir bauen einen kompletten Kubernetes-Cluster auf Embedded-Hardware. Dazu benutzen wir einen EdgeRouterX, 2 WLAN-Router, 2 Switche, ein Intel UP-Board und für den eigentlichen K8S-Cluster Raspberry Pi&rsquo;s.">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
<meta property="article:tag" content="kubernetes">
<meta property="article:tag" content="rpi">
<meta property="article:tag" content="raspberry">
<meta property="article:tag" content="raspberry pi">
<meta property="article:tag" content="Kubernetes Lab">
<meta property="article:tag" content="Kubernetes Setup">
<meta property="article:tag" content="Kubernetes Tutorial">
<meta property="article:tag" content="Kubernetes Workshop">
<meta property="article:tag" content="Kubernetes how to">
<meta property="article:tag" content="Kubernetes do it youself">
<meta property="article:tag" content="Kubernetes bee42">
<meta property="article:tag" content="bee42 solutions">
<meta property="article:tag" content="bee42">
<meta property="article:tag" content="Kubernetes learn">
<meta property="article:tag" content="Kubernetes first steps">
<meta property="article:tag" content="Docker">



<meta property="og:title" content="Kubernetes Cluster on Embedded" />
<meta property="og:description"content="Kubernetes in aller Munde Viele Entwickler und Administatoren interssieren sich gerade für Kubernetes. In allen großen Clouds ist Kuberentes verfügbar. Allerdings ist die Cloud für kleine Geldbeutel auf die Dauer etwas teuer. Um einfach mal verschiedene Experimente mit Kubernetes zu wagen gibt es doch bestimmt günstigere Weg die Spaß machen.
Die Idee Wir bauen einen kompletten Kubernetes-Cluster auf Embedded-Hardware. Dazu benutzen wir einen EdgeRouterX, 2 WLAN-Router, 2 Switche, ein Intel UP-Board und für den eigentlichen K8S-Cluster Raspberry Pi&rsquo;s." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://bee42.com/de/blog/Kubernetes_Cluster_Embedded/" />

	<meta property="og:image" content="/images/logo.svg" />



<meta property="og:updated_time" content="2018-05-17 00:00:00 &#43;0000 UTC"/>


<meta property="og:site_name" content="DevOps Trainings &amp; Consulting - bee42 solutions gmbh" />








<meta property="article:publisher" content="https://www.facebook.com/" />

<meta property="article:published_time" content="0001-01-01 00:00:00 &#43;0000 UTC" />

<meta property="article:modified_time" content="2018-05-17 00:00:00 &#43;0000 UTC" />
<meta property="article:section" content="blog" />






<meta itemprop="name" content="Kubernetes Cluster on Embedded">
<meta itemprop="description" content="Kubernetes in aller Munde Viele Entwickler und Administatoren interssieren sich gerade für Kubernetes. In allen großen Clouds ist Kuberentes verfügbar. Allerdings ist die Cloud für kleine Geldbeutel auf die Dauer etwas teuer. Um einfach mal verschiedene Experimente mit Kubernetes zu wagen gibt es doch bestimmt günstigere Weg die Spaß machen.
Die Idee Wir bauen einen kompletten Kubernetes-Cluster auf Embedded-Hardware. Dazu benutzen wir einen EdgeRouterX, 2 WLAN-Router, 2 Switche, ein Intel UP-Board und für den eigentlichen K8S-Cluster Raspberry Pi&rsquo;s.">





<meta itemprop="keywords" content="" />


<meta itemprop="wordCount" content="816">


	<meta name="twitter:card" content="summary"/>



<meta name="twitter:title" content="Kubernetes Cluster on Embedded"/>
<meta name="twitter:description" content="Kubernetes in aller Munde Viele Entwickler und Administatoren interssieren sich gerade für Kubernetes. In allen großen Clouds ist Kuberentes verfügbar. Allerdings ist die Cloud für kleine Geldbeutel auf die Dauer etwas teuer. Um einfach mal verschiedene Experimente mit Kubernetes zu wagen gibt es doch bestimmt günstigere Weg die Spaß machen.
Die Idee Wir bauen einen kompletten Kubernetes-Cluster auf Embedded-Hardware. Dazu benutzen wir einen EdgeRouterX, 2 WLAN-Router, 2 Switche, ein Intel UP-Board und für den eigentlichen K8S-Cluster Raspberry Pi&rsquo;s."/>


<meta name="twitter:creator" content="@bee42solutions"/>




<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-M8QDFPL');</script>

	<link rel="icon" href="/images/favicon.ico" type="image/x-icon">
	<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" sizes="64x64" href="images/apple-touch-icon.png">
	<link href="https://fonts.googleapis.com/css?family=Roboto:400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Roboto+Slab:300,400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet">
	<link rel="stylesheet" href="/css/tomorrow.css"/>
	<link rel="stylesheet" href="/css/main-0ddcfe7c.css" />
</head>

<body>

<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M8QDFPL"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<nav class="navigation">
	<div class="inner-content">
		<a class="branding" href="/"><img src="/images/logo.svg" alt=""></a>
   		 <ul>
	<li><a href="/de/index.html#scroll-top-trainings">Trainings</a></li>
	<li><a href="/de/blog">Blog</a></li>
	<li><a href="/de/index.html#scroll-top-services">Unser Angebot</a></li>
	<li><a href="/de/index.html#scroll-top-mission">Mission</a></li>
	<li><a href="/de/index.html#scroll-top-bee-crew">Bee<span>42</span> Crew</a></li>
	<li><a href="/de/index.html#scroll-top-jobs">Jobs</a></li>
	<li><a href="/de/kontakt">Kontakt</a></li>
	<li><a href="https://twitter.com/bee42solutions" class="fa fa-twitter" aria-hidden="true"></a></li>
</ul>

		<button class="burger" data-toggle="offCanvasRight"><i class="fa fa-bars" aria-hidden="true"></i></button>
	</div>
</nav>

<div class="off-canvas-wrapper">
	<div class="off-canvas-wrapper-inner" data-off-canvas-wrapper>
	<div class="off-canvas position-right" id="offCanvasRight" data-off-canvas data-position="right">
 		<ul>
	<li><a href="/de/index.html#scroll-top-trainings">Trainings</a></li>
	<li><a href="/de/blog">Blog</a></li>
	<li><a href="/de/index.html#scroll-top-services">Unser Angebot</a></li>
	<li><a href="/de/index.html#scroll-top-mission">Mission</a></li>
	<li><a href="/de/index.html#scroll-top-bee-crew">Bee<span>42</span> Crew</a></li>
	<li><a href="/de/index.html#scroll-top-jobs">Jobs</a></li>
	<li><a href="/de/kontakt">Kontakt</a></li>
	<li><a href="https://twitter.com/bee42solutions" class="fa fa-twitter" aria-hidden="true"></a></li>
</ul>

	</div>
	<div class="off-canvas-content" data-off-canvas-content>
	
		<header> 
			<div class="inner-content">
				<h1>
					Rethink IT 
					<span></span>
				</h1>
			</div>
		</header>

		<main>
 <section class="page-content blog">
       <section class="content-box">
               <h1>Kubernetes Cluster on Embedded</h1>
              <h2 id="kubernetes-in-aller-munde">Kubernetes in aller Munde</h2>

<p>Viele Entwickler und Administatoren interssieren sich gerade für Kubernetes. In allen großen Clouds ist Kuberentes verfügbar. Allerdings ist die Cloud für kleine Geldbeutel auf die Dauer etwas teuer. Um einfach mal verschiedene Experimente mit Kubernetes zu wagen gibt es doch bestimmt günstigere Weg die Spaß machen.</p>

<h2 id="die-idee">Die Idee</h2>

<p>Wir bauen einen kompletten Kubernetes-Cluster auf Embedded-Hardware. Dazu benutzen wir einen EdgeRouterX, 2 WLAN-Router, 2 Switche, ein Intel UP-Board und für den eigentlichen K8S-Cluster Raspberry Pi&rsquo;s.</p>

<p>Schematisch soll es so aussehen:</p>

<p><img src="/images/blog/kubernetes_cluster_embedded/layout.png" alt="Layout" /></p>

<p>Ein WLAN-Router stellt die Verbindung zum Internet her, den könnnt Ihr natürlich auch durch ein Kabel zu Eurem vorhanden Router ersetzen. Der EdgeRouterX ist für DHCP und DNS zuständig, und über den WLAN-Accesspoint können sich mehrere Leute mit der Umgebung verbinden. Dieses Setup benutzen wir gerne in Trainings und Workshops. Die verbleibende zentrale Komponente ist die Registry bzw. der Registry-Mirror auf dem Up-Board. Dieses hat eine Atom-CPU und ist um einiges performanter als die RPi&rsquo;s.</p>

<h2 id="unsere-hardware">Unsere Hardware</h2>

<p>Wir Ihr seht, ist also einiges an Hardware erforderlich. Die einzelnen Komponeten sind aber gar nicht sooo teuer :), bei vielen von Euch sind wahrscheinlich auch schon etliche Teile vorhanden.</p>

<p>Hier kurz die Liste der verwendeten Komponenten:</p>

<ul>
<li>2 x WLAN-Router (<a href="https://www.tp-link.com/us/products/details/cat-5506_TL-WR802N.html">https://www.tp-link.com/us/products/details/cat-5506_TL-WR802N.html</a>)</li>
</ul>

<p><img src="/images/blog/kubernetes_cluster_embedded/TL-WR802N.jpg" alt="wlan-router" /></p>

<ul>
<li>EdgeRouterX (<a href="https://www.ubnt.com/edgemax/edgerouter-x/">https://www.ubnt.com/edgemax/edgerouter-x/</a>)</li>
</ul>

<p><img src="/images/blog/kubernetes_cluster_embedded/edgerouterx.jpeg" alt="edge-router" /></p>

<ul>
<li>UP-Board (<a href="http://www.up-board.org/">http://www.up-board.org/</a>)</li>
</ul>

<p><img src="/images/blog/kubernetes_cluster_embedded/intel_up_board.png" alt="up-board" /></p>

<ul>
<li>Und natürlich jede Menge Raspberry PI&rsquo;s&hellip;</li>
</ul>

<p><img src="/images/blog/kubernetes_cluster_embedded/RPI-Cluster.jpg" alt="Layout" /></p>

<p>Weitere Infos+Links für die verwendeten Bauteile findet Ihr in unserem <a href="https://github.com/bee42/kubernetes-on-embedded">Github-Repo</a></p>

<h2 id="der-ablauf">Der Ablauf</h2>

<p>Der eigentliche Ablauf, um Kubernetes auf die RPIs zu bringen, besteht aus wenigen Schritten:</p>

<ul>
<li>Flashen der SD-Cards mit einem passenden OS-Image mit Docker</li>
<li>Erstellen eines Verzeichnisses mit allen Rechnern, die in den Cluster sollen</li>
<li>Installation von Kubernetes. Dazu haben wir ein kleines Installationsscript geschrieben.</li>
</ul>

<h2 id="die-verwendete-software">Die verwendete Software</h2>

<ul>
<li><a href="https://github.com/hypriot/image-builder-rpi/">Hypriot OS</a> Die Hypriot-Piraten stellen regelmäßig aktualisierte Images bereit - Vielen Dank dafür!</li>
<li><a href="https://www.docker.com/community-edition">Docker</a> - ist bereits vorinstalliert auf dem Hypriot-Image</li>
<li><a href="https://kubernetes.io/">Kubernetes</a> - (kubeadm)</li>
<li><a href="https://docs.docker.com/registry/recipes/mirror/">Docker Registry-Mirror</a></li>
<li><a href="www.ansible.com">Ansible</a></li>
</ul>

<h2 id="vorbereitung-der-raspberry-pi-s">Vorbereitung der Raspberry PI&rsquo;s</h2>

<p>Wir benötigen für Kubernetes eine unterstützte Docker Version, in diesem Fall Docker CE 17.03. Das passende Image dazu hat die Versionsnummer v1.4.0. Wir haben natürlich auch andere Kombinationen ausprobiert, aber spätestens beim Installieren des Netzwerklayers kam es zu Inkompatibilitäten.</p>

<h3 id="flashen-des-os-images">Flashen des OS-Images</h3>

<p>Am einfachsten funktioniert das flashen mit dem <a href="https://github.com/hypriot/flash">Flash-Tool der Hyprioten</a> (Die Installation des Flash-Programme haben wir auf <a href="https://github.com/bee42/kubernetes-on-embedded">Github</a> näher beschrieben!)</p>

<pre><code class="language-bash">$ flash -n &quot;MY_HOSTNAME&quot; hypriotos-rpi-v${HOS_VERSION}.img
</code></pre>

<p><br></p>

<h3 id="raspberry-pi-s-starten">Raspberry-Pi&rsquo;s starten</h3>

<p>Nach dem Einsetzen der Karten könnt Ihr die Raspberry-PI starten. Nun könnt Ihr Euch zum Test mit dem PI per SSH verbinden.</p>

<pre><code class="language-bash">$ ssh pirate@&lt;ip&gt;
</code></pre>

<p>Das Passwort für den Nutzer <strong>pirate</strong> lautet: <strong>hypriot</strong>.</p>

<p><strong>Frage</strong>: Wie bekommt man eigentlich heraus welche IP dem PI vom DHCP Server zugeordnet wurde?</p>

<p>Wenn Ihr es nicht auf Eurem Router/DHCP-Server nachschauen könnt, geht das am einfachsten mit einem Netzwerk-Scan:</p>

<pre><code># install nmap
$ brew install nmap
$ nmap -sn 192.168.1.0/24 # Durch Euer Netz ersetzen
</code></pre>

<p><br></p>

<h2 id="kubernetes-cluster-installieren">Kubernetes-Cluster installieren</h2>

<h3 id="vorbereitung">Vorbereitung</h3>

<p>Zur Ausführung unseres Installationsscripts auf den einzelen RPIs benutzen wir <a href="https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html">Ansible</a>.</p>

<p>Wir brauchen zuerst ein Inhaltsverzeichnis, in dem die verwendeten IP-Adressen der zukünftigen Cluster-Nodes stehen. Wir haben mehrere Cluster, deshalb ist die Konfiguration etwas größer angelegt. Hier ein Auszug für Cluster-1:</p>

<p><strong>inventory.ini</strong></p>

<pre><code class="language-ini">[cluster-1-master]
192.168.1.11

[cluster-1-nodes]
192.168.1.12
192.168.1.13

[cluster-1:children]
cluster-1-master
cluster-1-nodes

[cluster-1:vars]
fqdn_master=&quot;bee42-crew-01-001.bee42&quot;
network_address_master=&quot;192.168.1.11&quot;

[master:children]
cluster-1-master

[nodes:children]
cluster-1-nodes
</code></pre>

<p><br>
Ansible verbindet sich per SSH auf die zu verwaltenden Rechner, dort muss also Euer öffentlicher SSH-Key hinterlegt sein. Falls Ihr das noch nicht bereits erledigt habt, könnt Ihr das jetzt nachholen.</p>

<p>Hier ein kleines Beispiel:</p>

<pre><code class="language-bash"># Schlüssel erzeugen
$ ssh-keygen -t ed25519 -C &quot;name@example.org&quot;

# Öffentlichen Schlüssel auf alle RPIs kopieren
$ ssh-copy-id pirate@192.168.1.11
$ ssh-copy-id pirate@192.168.1.12
...

# und testen:

$ ansible -u pirate --key=PATH_TO_MY_PRIVATE_KEY -m ping all
192.168.1.11 | success &gt;&gt; {
    &quot;changed&quot;: false, 
    &quot;ping&quot;: &quot;pong&quot;
}

192.168.1.12 | success &gt;&gt; {
    &quot;changed&quot;: false, 
    &quot;ping&quot;: &quot;pong&quot;
}
</code></pre>

<p><br/></p>

<h3 id="cluster-erzeugen">Cluster erzeugen</h3>

<p>So, wenn alle Vorbereitungen abgeschlossen sind, kann der Kubernetes-Cluster erzeugt werden. Ein Raspberry PI pro Cluster wird zum Master, die restlichen PIs werden die Nodes.</p>

<pre><code class="language-bash">$ ansible-playbook -u pirate --key=PATH_TO_MY_PRIVATE_KEY -i cluster -l cluster-1 kubernetes.yml
</code></pre>

<p><br></p>

<p>Dadurch werden folgende Schritte ausgeführt:</p>

<ul>
<li>Die benötigte Pakete werden heruntergeladen und installiert.</li>
<li>Auf dem Master-Rechner wird per <code>kubeadm init</code> die Kubernetes-Installation gestartet</li>
<li>Der Weave-Netzwerk-Layer für Kubernetes wird installiert</li>
<li>Eine kleine Datei <code>kubeadm_join</code> wird erzeugt und heruntergeladen. Darin steht das Kommando, um einen weiteren Node zu dem Cluster hinzuzufügen</li>
<li>Auf allen Nodes wird danach das entsprechende Join-Kommando ausgeführt</li>
</ul>

<p><strong>Noch ein wichtiger Hinweis:</strong> In unserem Script wird die Verwendung eines lokalen Registry-Mirrors eingerichtet. Dadurch müssen die Container-Images nur einmal zentral heruntergeladen werden und nicht von jedem einzelnen RPi selbst. <strong>Das müsstet Ihr ggf. anpassen/auskommentieren.</strong></p>

<p>Im Ordner <code>secrets</code> findet Ihr danach die Config-Datei für Kubernetes, oder Ihr springt auf den Master-Rechner und könnt dort als Root (<code>sudo -i</code>) dann Euren Cluster per <code>kubectl</code> verwalten. Also z.B. alle Nodes anzeigen mit</p>

<pre><code>$ kubectl get nodes
</code></pre>

<p>Und so sieht übrigens alles fertig aufgebaut aus:</p>

<p><img src="/images/blog/kubernetes_cluster_embedded/gesamtueberblick.jpg" alt="Layout" />
<br>
Wenn Ihr Euch das genauer ansehen wollt: Alle Dateien stehen auf <a href="https://github.com/bee42/kubernetes-on-embedded">Github</a> bereit.</p>

<p>Viel Spaß mit dem Aufbau und besucht uns auf einem unser <a href="https://bee42.com/de/trainings/kubernetes-devops-lab/">Kubernetes Lab</a> zum ausprobieren. Wir kommen auch gerne zu Euch mit einem InHouse-Training&hellip;</p>

<p><img src="/images/blog/kubernetes_cluster_embedded/raspberrypi-joins-kubernetes.png" alt="KubernetesLoveRaspberryPI" /></p>

<p>Die bee42 Crew   

								

<section id="author" class="small-12 medium-12 large-12 columns">

  
  

  <h3> </h3>
    
    <p>Read <a href="/de/blog">more blog posts</a> from  us.</p>
    

    <ul>
    
    
    
    
    
    </ul>
  </section>



      </section> 
</section>

<div class="overlay"></div>
<section class=" newsletter" id="newsletter">

    <section class="content-box">
        <h2>Newsletter</h2>
<div id="mc_embed_signup">
    <form action="https://bee42.us14.list-manage.com/subscribe/post?u=824895018aee17c0d9e3a50b7&amp;amp;id=773b3ea586" method="post" id="mc-embedded-subscribe-form"
        name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
        <div class="mc_embed_signup_scroll">
            <h3>Bleibe auf dem Laufenden und erhalte regelmäßig Updates, Blogposts, Termine und viele weitere Highlights.
</h3>
            <div class="indicates-required">
                <span class="asterisk">*</span> indicates required</div>

            <div class="mc-field-group">
                <label for="mce-EMAIL">Email-Adresse eintragen
                    <span class="asterisk">*</span>
                </label>
                <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL" placeholder="Email Address">
            </div>

            <div id="mce-responses" class="clear">
                <div class="response" id="mce-error-response" style="display:none"></div>
                <div class="response" id="mce-success-response" style="display:none"></div>
            </div>
            
            <div style="position: absolute; left: -5000px;" aria-hidden="true">
                <input type="text" name="b_824895018aee17c0d9e3a50b7_1f79b85105" tabindex="-1" value="">
            </div>
            
                <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
            
        </div>
    </form>
</div>
    </section>
    </section>

<footer>
    <section class="content-box">
        <a class="branding" href="/"><img src="/images/logo.svg" alt=""> </a>
        <p>&copy; 2018</p>
        <a class="imprint" href="/de/allgemeine-geschaeftsbedingungen">AGB</a>
        <a class="imprint" href="/de/datenschutz">Datenschutz</a>
        <a class="imprint" href="/de/impressum">Impressum</a>
    </section>
</footer>

				</main>
			</div>
		</div>
	</div>

	<script src="/js/jquery.min.js"></script>
	<script src="/js/foundation.min.js"></script>
	<script src="/js/jquery.validate.min.js"></script>
	<script src="/js/highlight.pack.js"></script>
	<script src="/js/slick.js"></script>
	<script src="/js/main.js"></script>
  
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-58949839-1', 'auto');
ga('send', 'pageview');
</script>

	</body>
<html>
